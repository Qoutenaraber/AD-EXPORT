Sub ImportCSVAndCreateOrgChart()
    Dim csvFilePath As String
    csvFilePath = "C:\path\to\your\file.csv"
    
    Dim fso As Object
    Set fso = CreateObject("Scripting.FileSystemObject")
    Dim file As Object
    Set file = fso.OpenTextFile(csvFilePath, 1)
    
    Dim headerLine As String
    headerLine = file.ReadLine()
    
    Dim shapesDict As Object
    Set shapesDict = CreateObject("Scripting.Dictionary")
    
    Dim visioApp As Visio.Application
    Set visioApp = CreateObject("Visio.Application")
    Dim visioDoc As Visio.Document
    Set visioDoc = visioApp.Documents.Add("")
    
    Dim masterShape As Visio.Master
    Set masterShape = visioApp.Documents("Basic Shapes.vss").Masters("Rectangle")
    
    Do Until file.AtEndOfStream
        Dim line As String
        line = file.ReadLine()
        Dim parts() As String
        parts = Split(line, ",")
        
        Dim name As String
        name = parts(0)
        Dim distinguishedName As String
        distinguishedName = parts(1)
        
        Dim visioShape As Visio.Shape
        Set visioShape = visioDoc.Pages(1).Drop(masterShape, 4.25, 5.5)
        visioShape.Text = name
        shapesDict.Add distinguishedName, visioShape
    Loop
    file.Close
    
    Dim key As Variant
    For Each key In shapesDict.Keys
        Dim parentDn As String
        parentDn = GetParentDN(key)
        
        If shapesDict.Exists(parentDn) Then
            Dim childShape As Visio.Shape
            Dim parentShape As Visio.Shape
            Set childShape = shapesDict(key)
            Set parentShape = shapesDict(parentDn)
            
            Dim connector As Visio.Shape
            Set connector = visioDoc.Pages(1).Drop(visioApp.Documents("Basic Shapes.vss").Masters("Dynamic Connector"), 0, 0)
            connector.Cells("BeginX").GlueTo parentShape.Cells("PinX")
            connector.Cells("EndX").GlueTo childShape.Cells("PinX")
        End If
    Next key
End Sub

Function GetParentDN(dn As String) As String
    Dim parts() As String
    parts = Split(dn, ",")
    If UBound(parts) > 0 Then
        ReDim Preserve parts(UBound(parts) - 1)
        GetParentDN = Join(parts, ",")
    Else
        GetParentDN = ""
    End If
End Function